<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Розрахунок часу та здачі</title>
<style>
body { font-family: Arial, sans-serif; max-width:700px; margin:20px auto; background:#f7f7f7; padding:12px;}
main, header { background:#fff; padding:16px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.06);}
h3 { margin-top:0; }
label { display:block; margin-left: 10px; }
.radio-group label { margin-right:12px; }
.radio-group p {margin-bottom: 7px; font-weight: bold; color:#dd2d4a}
input[type="text"], input[type="number"] { padding:6px 8px; margin-top:6px; border-radius:5px; margin-left: 5px; border-color: #6aa84f; }
button{ border-radius:5px; color:#feffff;background-color:#2d8fdd; font-size: 15px;}
#results { margin-top:14px; padding:10px; background:#eef5ff; border-radius:6px; display:flex; gap:12px; flex-wrap:wrap; }
#tabl{display: flex; justify-content: center; }
#table img {display: block;margin: 0 auto;max-width: 100%;}
#resultSimple{margin-left: 10px; font-size: 17px; font-weight: bold; color:#dd2d4a}
.res-line { padding:6px 10px; border-radius:6px; font-weight:600; color:#fff; }
.kp { background:#2d8fdd; }
.zd { background:#6aa84f; }
.end { background:#e06666; }
.hr-divider {
    border: none;
    height: 1px;
    background-color: #2d8fdd; /* колір синій, як у кнопок/блоків */
    opacity: 0.3;               /* трохи прозора */
    margin: 20px 0;
    border-radius: 2px;
}
.top_lab{font-weight: bold;}
.top {color:#3e249c; background-color: rgba(45, 143, 221, 0.1); /* світло-синій прозорий фон */
    border-right: 4px solid #2d8fdd; /* акцентна лінія зліва */
    border-radius: 6px;
    color: #2d8fdd;
    font-weight: 600;
    font-style: italic;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
.res_simple{ margin-left: 20px;}
.footer {
    margin-top: 30px;
    padding: 12px 20px;
    background-color: rgba(45, 143, 221, 0.1); /* світло-синій прозорий фон */
    border-left: 4px solid #2d8fdd; /* акцентна лінія зліва */
    border-radius: 6px;
    font-size: 14px;
    color: #2d8fdd;
    text-align: right;
    font-weight: 600;
    font-style: italic;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
</style>
</head>
<body>

<!-- Блок : Розрахунок здачі/явки -->
<header>
<h3 class="top">Розрахунок здачі, явки та кінця роботи лок. бригади.</h3>

<label class="top_lab">Введіть час прибуття або відправлення (год.хв, можна . , : -)</label>
<input type="text" id="timeInputCalc" placeholder="наприклад 5.45">

<div class="radio-group">
  <p>Кількість вагонів:</p>
  <label><input type="radio" name="wagons" value="4" checked> 4</label>
  <label><input type="radio" name="wagons" value="6"> 6</label>
  <label><input type="radio" name="wagons" value="8"> 8</label>
</div>

<div class="radio-group">
  <p>Станція:</p>
  <label><input type="radio" name="city" value="chernihiv" checked> Чернігів</label>
  <label><input type="radio" name="city" value="nizhin"> Ніжин</label>
</div>

<div class="radio-group" id="operationGroup">
  <p>Операція:</p>
  <label><input type="radio" name="operation" value="zdacha" checked> Здача</label>
  <label id="pryimannyaLabel"><input type="radio" name="operation" value="pryimannya"> Приймання (явка, розраховує тільки для Ніжина)</label>
</div>

<div class="radio-group" id="placeGroup">
  <p>Місце / дія:</p>
  <label><input type="radio" name="place" value="brigade" checked> На ст. лок. бригаді</label>
  <label><input type="radio" name="place" value="stay"> На ст. у відстій</label>
  <label id="depoCrossLabel"><input type="radio" name="place" value="depo_cross"> Заїзд в депо по з'їзду</label><br>
  <label id="depo21Label"><input type="radio" name="place" value="depo_21"> Заїзд в депо по 21</label>
</div>

<div class="radio-group" id="nextGroup">
  <p>Подальша дія (тільки при заїзді в депо)</p>
  <label><input type="radio" name="next" value="stay" checked> У відстій</label>
  <label><input type="radio" name="next" value="to"> На ТО</label>
</div>
<br>
<button  onclick="calculate()">Розрахувати</button>

<div id="results">
  <div id="result_kp" class="res-line kp"></div>
  <div id="result_zd" class="res-line zd"></div>
  <div id="result_end" class="res-line end"></div>
</div>
</header>
<script>
// -------- Блок : Операції з часом --------
function parseTimeSimple(){
    let t = document.getElementById("timeInputSimple").value.replace(/[:,\-]/g,'.').trim();
    if(!t.includes('.')) return null;
    let [h,m] = t.split('.').map(Number);
    if(isNaN(h)||isNaN(m)) return null;
    return h*60 + m;
}

function formatTimeSimple(total){
    total = ((total%1440)+1440)%1440;
    let h = Math.floor(total/60);
    let m = total%60;
    return h+'.'+m.toString().padStart(2,'0');
}

function addTimeSimple(){
    let minutes = parseTimeSimple();
    if(minutes===null){alert('Невірний формат'); return;}
    let add = parseInt(document.getElementById("minutesInputSimple").value);
    document.getElementById("resultSimple").innerText = formatTimeSimple(minutes + add);
}

function subtractTimeSimple(){
    let minutes = parseTimeSimple();
    if(minutes===null){alert('Невірний формат'); return;}
    let sub = parseInt(document.getElementById("minutesInputSimple").value);
    document.getElementById("resultSimple").innerText = formatTimeSimple(minutes - sub);
}

// -------- Блок 2: Розрахунок здачі/явки --------
const rules = {
    chernihiv: {
        zdacha: {
            brigade: {4:9, 6:11, 8:14, endAdd:26},
            stay: {4:11, 6:16, 8:21, endAdd:26},
            depo_cross: {4:22,6:31,8:39,endAdd:15},
            depo_cross_stay: {4:15,6:20,8:25,endAdd:15},
            depo_21: {4:25,6:34,8:43,endAdd:15},
            depo_21_stay: {4:18,6:23,8:28,endAdd:15}
        },
        kp: {brigade:0, stay:0, depo_cross:20, depo_cross_stay:20, depo_21:27, depo_21_stay:27}
    },
    nizhin: {
        zdacha: {
            brigade: {4:9, 6:11, 8:14, endAdd:20},  // <-- Нова логіка як у Чернігова
            stay: {4:11, 6:16, 8:21, endAdd:20}    // Можна аналогічно для відстою, якщо потрібно
        },
        kp: {brigade:0, stay:0}
    }
};

// -------- Селектори --------
const cityRadios = document.querySelectorAll('input[name="city"]');
const operationRadios = document.querySelectorAll('input[name="operation"]');
const placeGroup = document.getElementById('placeGroup');
const nextGroup = document.getElementById('nextGroup');
const depoCrossLabel = document.getElementById('depoCrossLabel');
const depo21Label = document.getElementById('depo21Label');
const pryimannyaLabel = document.getElementById('pryimannyaLabel');

// -------- Оновлення видимості блоків --------
function updatePlaceVisibility() {
    const city = document.querySelector('input[name="city"]:checked')?.value;
    const operation = document.querySelector('input[name="operation"]:checked')?.value;

    // Приймання в Чернігові → ховаємо і повідомляємо
    if (city === 'chernihiv' && operation === 'pryimannya') {
        placeGroup.style.display = 'none';
        nextGroup.style.display = 'none';
        document.getElementById('results').innerHTML = "<p>Цей функціонал ще не дороблено</p>";
        return;
    }

    // Приймання в Ніжині → ховаємо блоки місце/дія і next, показуємо тільки результат
    if (city === 'nizhin' && operation === 'pryimannya') {
        placeGroup.style.display = 'none';
        nextGroup.style.display = 'none';
        document.getElementById('results').innerHTML = `
            <div id="result_kp" class="res-line kp">КП: 0</div>
            <div id="result_zd" class="res-line zd">Приймання: </div>
            <div id="result_end" class="res-line end">З відстою</div>
        `;
        return;
    }

    // Для всіх інших випадків
    placeGroup.style.display = 'block';

    // За замовчуванням показуємо заїзди в депо
    depoCrossLabel.style.display = 'inline';
    depo21Label.style.display = 'inline';

    // Якщо Ніжин + здача → ховаємо заїзди в депо
    if (city === 'nizhin' && operation === 'zdacha') {
        depoCrossLabel.style.display = 'none';
        depo21Label.style.display = 'none';
    }

    // Отримуємо значення місця
    let placeRadio = document.querySelector('input[name="place"]:checked');
    if (!placeRadio) {
        document.querySelector('input[name="place"][value="brigade"]').checked = true;
        placeRadio = document.querySelector('input[name="place"]:checked');
    }
    const placeVal = placeRadio.value;

    // Логіка показу nextGroup
    if (city === 'chernihiv' && operation === 'zdacha') {
        if (placeVal === 'brigade' || placeVal === 'stay') {
            nextGroup.style.display = 'none'; // ховаємо для станцій
        } else if (placeVal === 'depo_cross' || placeVal === 'depo_21') {
            nextGroup.style.display = 'block'; // показуємо для депо
        }
    } else if (placeVal === 'depo_cross' || placeVal === 'depo_21') {
        nextGroup.style.display = 'block'; // для всіх інших випадків депо
    } else {
        nextGroup.style.display = 'none';
    }

    // Показуємо блоки результатів, якщо він пустий
    if (!document.getElementById('result_kp')) {
        document.getElementById('results').innerHTML = `
            <div id="result_kp" class="res-line kp"></div>
            <div id="result_zd" class="res-line zd"></div>
            <div id="result_end" class="res-line end"></div>
        `;
    }
}

// -------- Слухачі --------
const allRadios = document.querySelectorAll(
  'input[name="wagons"], input[name="city"], input[name="operation"], input[name="place"], input[name="next"]'
);
allRadios.forEach(radio=>{
    radio.addEventListener('change', ()=>{
        updatePlaceVisibility();
        calculate();
    });
});

// -------- Парсер і формат часу --------
function parseTimeCalc(input){
    input = input.replace(/[:,\-]/g,'.').trim();
    if(!input.includes('.')) return null;
    let [h,m] = input.split('.').map(Number);
    if(isNaN(h)||isNaN(m)) return null;
    return h*60 + m;
}

function formatTimeCalc(total){
    total = ((total%1440)+1440)%1440;
    let h = Math.floor(total/60);
    let m = total%60;
    return h+'.'+m.toString().padStart(2,'0');
}

// -------- Розрахунок --------
function calculate() {
    const city = document.querySelector('input[name="city"]:checked').value;
    const operation = document.querySelector('input[name="operation"]:checked').value;
    const wagons = parseInt(document.querySelector('input[name="wagons"]:checked').value);
    let place = document.querySelector('input[name="place"]:checked')?.value || 'brigade';
    let next = document.querySelector('input[name="next"]:checked')?.value || 'to';
    const inputTime = document.getElementById('timeInputCalc').value.trim();
    if (inputTime === "") return;

    const baseTime = parseTimeCalc(inputTime);
    if (baseTime === null){ alert('Неправильний формат часу'); return; }

    let kp = 0, zdTime = 0, endTime = 0;

    // ---------------- Чернігів ----------------
    if(city==='chernihiv') {
        if(operation==='zdacha') {
            // Станції: brigade / stay → КП = 0
            if(place==='brigade' || place==='stay') {
                kp = 0;
                zdTime = rules.chernihiv.zdacha[place][wagons] || 0;
                endTime = baseTime + zdTime + rules.chernihiv.zdacha[place].endAdd;
                document.getElementById('result_kp').innerText = `КП: 0`;
                document.getElementById('result_zd').innerText = `Здача: ${formatTimeCalc(baseTime + zdTime)}`;
                document.getElementById('result_end').innerText = `Кінець роботи: ${formatTimeCalc(endTime)}`;
            }
            // Депо
            else {
                if((place==='depo_cross' || place==='depo_21') && next==='stay') place = place+'_stay';
                kp = rules.chernihiv.kp[place] || 0;
                zdTime = rules.chernihiv.zdacha[place][wagons] || 0;
                endTime = baseTime + kp + zdTime + rules.chernihiv.zdacha[place].endAdd;
                document.getElementById('result_kp').innerText = `КП: ${formatTimeCalc(kp + baseTime)}`;
                document.getElementById('result_zd').innerText = `Здача: ${formatTimeCalc(baseTime + kp + zdTime)}`;
                document.getElementById('result_end').innerText = `Кінець роботи: ${formatTimeCalc(endTime)}`;
            }
        }
    }

    // ---------------- Ніжин ----------------
    else if(city==='nizhin') {
        if(operation==='zdacha') {
            kp = rules.nizhin.kp[place] || 0;
            zdTime = rules.nizhin.zdacha[place]?.[wagons] || 0;
            endTime = baseTime + kp + zdTime + (rules.nizhin.zdacha[place]?.endAdd || 20);
            document.getElementById('result_kp').innerText = `КП: ${formatTimeCalc(kp + baseTime)}`;
            document.getElementById('result_zd').innerText = `Здача: ${formatTimeCalc(baseTime + kp + zdTime)}`;
            document.getElementById('result_end').innerText = `Кінець роботи: ${formatTimeCalc(endTime)}`;
        }
        else if(operation==='pryimannya') {
            const pryimTime = {4:84,6:95,8:105}[wagons] || 0;
            const yavka = baseTime - pryimTime;        // час явки
            const pryimannya = yavka + 20;             // явка + 20 хв
            document.getElementById('result_kp').innerText = `КП: 0`;
            document.getElementById('result_end').innerText = `Явка: ${formatTimeCalc(yavka)}`;
            document.getElementById('result_zd').innerText = `Приймання: ${formatTimeCalc(pryimannya)}`;
        }
    }
}
// -------- Ініціалізація --------
updatePlaceVisibility();
calculate();
</script>

<hr class="hr-divider">
<main>
<h3>Операції з часом (год.хв)</h3>

<label>Час (формат год.хв, можна . , : -):</label>
<input type="text" id="timeInputSimple" placeholder="наприклад 5.45">
<br><br>
<label>Хвилини:</label>
<input type="number" id="minutesInputSimple" placeholder="наприклад 115"><br><br>

<button onclick="subtractTimeSimple()">Відняти хвилини</button>
<button onclick="addTimeSimple()">Додати хвилини</button><br><br>

<h3 class="res_simple">Результат:</h3>
<div id="resultSimple"></div>
</main>
<hr class="hr-divider">

<p class="line"></p>
<footer>
    <div  id="table" >
        <img src="images/time.jpg">
    </div>
    <div class="footer">
    Розробник: Барташ Євгеній
</div>

</footer>

</body>
</html>
